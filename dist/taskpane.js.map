{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane/./src/taskpane/taskpane.ts"],"sourcesContent":["// Declare Office and Excel APIs\r\ndeclare const Office: any;\r\ndeclare const Excel: any;\r\ndeclare const document: any;\r\n\r\n// Define an interface for filters\r\ninterface Filter {\r\n  column: string;\r\n  values: string;\r\n}\r\n\r\nconst EMAIL_DISCLAIMER = \"This email was sent using the Excel add-in, 'teacherhelper'. Please do NOT reply to no-reply.teacherhelper@outlook.com\";\r\n\r\n// Initialize global variables\r\nlet filters: Filter[] = [];\r\nlet columnTitles: string[] = [];\r\n\r\nlet instructionsVisible = false;\r\n\r\n// Initialize the counter\r\nlet emailCounter = 100;\r\nlet lastResetDate: string;\r\n\r\n// At the top of your file, add these constants for original values\r\nconst ORIGINAL_INSTITUTION = \"university\";\r\nconst ORIGINAL_PERSONA = \"professor\";\r\nconst ORIGINAL_AUDIENCE = \"students\";\r\nconst ORIGINAL_TONE = \"professional\";\r\nconst ORIGINAL_MAX_TOKENS = 300;\r\nconst ORIGINAL_TEMPERATURE = 0.7;\r\n\r\n// Your existing variables\r\nlet institution = ORIGINAL_INSTITUTION;\r\nlet persona = ORIGINAL_PERSONA;\r\nlet audience = ORIGINAL_AUDIENCE;\r\nlet tone = ORIGINAL_TONE;\r\nlet maxTokens = ORIGINAL_MAX_TOKENS;\r\nlet temperature = ORIGINAL_TEMPERATURE;\r\n\r\n// Office.onReady function - runs when the Office APIs are ready\r\nOffice.onReady((info) => {\r\n  console.log(\"Office.onReady called\");\r\n  document.getElementById(\"loading\")!.style.display = \"none\";\r\n\r\n  if (info.host === Office.HostType.Excel) {\r\n    console.log(\"Excel host detected\");\r\n    document.getElementById(\"app-body\")!.style.display = \"flex\";\r\n    setupInstructionsToggle();\r\n    initializeAdvancedSettings();\r\n    loadCounterState();\r\n    setupSignInToggle();\r\n    loadSignInOptions();\r\n\r\n\r\n    // Set up Excel-specific functionality\r\n    Excel.run(async (context) => {\r\n      const sheet = context.workbook.worksheets.getActiveWorksheet();\r\n\r\n      // event handler for worksheet change\r\n      sheet.onChanged.add(handleWorksheetChange);\r\n      // event handler for worksheet addition or deletion\r\n      context.workbook.worksheets.onActivated.add(handleWorksheetChange);\r\n\r\n      await context.sync();\r\n      console.log(\"Event handlers added for worksheet changes\");\r\n\r\n      // Initial population of column titles and menus\r\n      await getColumnTitles();\r\n      populateColumnTitlesMenu();\r\n    }).catch((error) => {\r\n      console.error(\"Error setting up event handlers:\", error);\r\n      showNotification(\"Failed to set up automatic updates. Please refresh manually if needed.\", true);\r\n    });\r\n\r\n    // Load the saved signature\r\n    loadSignature();\r\n\r\n    // Load the saved sender email\r\n    loadSenderEmail();\r\n\r\n    // event listeners for UI elements\r\n    document.getElementById(\"generate-draft\")!.addEventListener(\"click\", generateEmailDraft);\r\n    document.getElementById(\"send-emails\")!.addEventListener(\"click\", sendEmails);\r\n    document.getElementById(\"options\")!.addEventListener(\"change\", handleOptionsChange);\r\n    document.getElementById(\"add-filter\")!.addEventListener(\"click\", addFilter);\r\n    document.getElementById(\"save-signature\")!.addEventListener(\"click\", saveSignature);\r\n    document.getElementById(\"save-sender-email\")!.addEventListener(\"click\", saveSenderEmail);\r\n    document.getElementById(\"save-signin-options\")!.addEventListener(\"click\", saveSignInOptions);\r\n\r\n  } else {\r\n    console.log(\"Unsupported host detected:\", info.host);\r\n  }\r\n});\r\n\r\n// Function to get column titles from the active Excel worksheet\r\nasync function getColumnTitles(): Promise<void> {\r\n  try {\r\n    await Excel.run(async (context: any) => {\r\n      console.log(\"Fetching column titles...\");\r\n\r\n      const sheet = context.workbook.worksheets.getActiveWorksheet();\r\n      const range = sheet.getUsedRange();\r\n      const headerRow = range.getRow(0);\r\n      headerRow.load(\"values\");\r\n\r\n      await context.sync();\r\n\r\n      if (!headerRow.values || headerRow.values.length === 0 || headerRow.values[0].length === 0) {\r\n        throw new Error(\"No data found in the first row of the sheet\");\r\n      }\r\n\r\n      columnTitles = headerRow.values[0] as string[];\r\n      console.log(\"Column titles updated:\", columnTitles);\r\n\r\n      // Update the email column menu\r\n      populateEmailColumnMenu();\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error fetching column titles:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Function to populate dropdown menus with column titles\r\nfunction populateColumnTitlesMenu() {\r\n  const menus = document.getElementsByClassName(\"columnTitlesMenu\");\r\n  Array.from(menus).forEach((menu: HTMLSelectElement) => {\r\n    menu.innerHTML = \"\"; // Clear existing options\r\n\r\n    // Add a default option\r\n    const defaultOption = document.createElement(\"option\");\r\n    defaultOption.text = \"Select a column\";\r\n    defaultOption.value = \"\";\r\n    menu.appendChild(defaultOption);\r\n\r\n    // Add options for each column title\r\n    columnTitles.forEach((title, index) => {\r\n      const option = document.createElement(\"option\");\r\n      option.value = index.toString();\r\n      option.text = title;\r\n      menu.appendChild(option);\r\n    });\r\n  });\r\n}\r\n\r\n// Function to populate the email column dropdown menu\r\nfunction populateEmailColumnMenu() {\r\n  const emailColumnMenu = document.getElementById(\"email-column\") as HTMLSelectElement;\r\n  if (!emailColumnMenu) {\r\n    console.error(\"Email column menu not found\");\r\n    return;\r\n  }\r\n  emailColumnMenu.innerHTML = \"\"; // Clear existing options\r\n\r\n  // Add a default option\r\n  const defaultOption = document.createElement(\"option\");\r\n  defaultOption.text = \"Select a column\";\r\n  defaultOption.value = \"\";\r\n  emailColumnMenu.appendChild(defaultOption);\r\n\r\n  // Add options for each column title\r\n  columnTitles.forEach((title, index) => {\r\n    const option = document.createElement(\"option\");\r\n    option.value = index.toString();\r\n    option.text = title;\r\n    emailColumnMenu.appendChild(option);\r\n  });\r\n\r\n  // Detect and select email column\r\n  const emailColumnIndex = detectEmailColumn(columnTitles);\r\n  if (emailColumnIndex !== -1) {\r\n    emailColumnMenu.value = emailColumnIndex.toString();\r\n  }\r\n\r\n  console.log(\"Email column menu populated with\", columnTitles.length, \"options\");\r\n  console.log(\"Automatically selected email column:\", emailColumnIndex);\r\n}\r\n\r\n// Function to insert a column title into the textarea\r\nfunction insertColumnTitle(textarea: HTMLTextAreaElement, title: string, position: number) {\r\n  const before = textarea.value.substring(0, position);\r\n  const after = textarea.value.substring(position);\r\n  textarea.value = before + title + after;\r\n  textarea.selectionStart = textarea.selectionEnd = position + title.length;\r\n  textarea.focus();\r\n}\r\n\r\n// Function to handle changes in the options dropdown\r\nfunction handleOptionsChange(event: Event) {\r\n  const select = event.target as HTMLSelectElement;\r\n  const addFilterButton = document.getElementById(\"add-filter\") as HTMLButtonElement;\r\n  addFilterButton.style.display = select.value === \"specific\" ? \"inline-block\" : \"none\";\r\n  if (select.value !== \"specific\") {\r\n    filters = [];\r\n    updateFilterDisplay();\r\n    console.log(\"Filters cleared:\", JSON.stringify(filters));\r\n  }\r\n}\r\n\r\n// Function to add a new filter\r\nfunction addFilter() {\r\n  const filter: Filter = {\r\n    column: \"\",\r\n    values: \"\",\r\n  };\r\n  const filterContainer = document.createElement(\"div\");\r\n  filterContainer.className = \"filter-container\";\r\n  const columnSelect = createColumnSelect(filter);\r\n  const valuesInput = createValuesInput(filter);\r\n  const deleteButton = createDeleteButton(filter, filterContainer);\r\n  filterContainer.appendChild(columnSelect);\r\n  filterContainer.appendChild(valuesInput);\r\n  filterContainer.appendChild(deleteButton);\r\n  document.getElementById(\"filter-containers\")!.appendChild(filterContainer);\r\n  filters.push(filter);\r\n  console.log(\"Current filters:\", JSON.stringify(filters));\r\n\r\n  // Populate the newly created column select\r\n  populateColumnSelect(columnSelect);\r\n}\r\n\r\n// Function to create a column select dropdown for filters\r\nfunction createColumnSelect(filter: Filter): HTMLSelectElement {\r\n  const columnSelect = document.createElement(\"select\");\r\n  columnSelect.className = \"columnTitlesMenu\";\r\n  columnSelect.addEventListener(\"change\", function (this: HTMLSelectElement) {\r\n    filter.column = columnTitles[parseInt(this.value)];\r\n  });\r\n  return columnSelect;\r\n}\r\n\r\n// Function to populate a column select dropdown\r\nfunction populateColumnSelect(columnSelect: HTMLSelectElement) {\r\n  columnSelect.innerHTML = \"\"; // Clear existing options\r\n\r\n  // Add a default option\r\n  const defaultOption = document.createElement(\"option\");\r\n  defaultOption.text = \"Select a column\";\r\n  defaultOption.value = \"\";\r\n  columnSelect.appendChild(defaultOption);\r\n\r\n  // Add options for each column title\r\n  columnTitles.forEach((title, index) => {\r\n    const option = document.createElement(\"option\");\r\n    option.value = index.toString();\r\n    option.text = title;\r\n    columnSelect.appendChild(option);\r\n  });\r\n}\r\n\r\n// Function to create an input field for filter values\r\nfunction createValuesInput(filter: Filter): HTMLInputElement {\r\n  const valuesInput = document.createElement(\"input\");\r\n  valuesInput.type = \"text\";\r\n  valuesInput.placeholder = \"Enter values (comma-separated)\";\r\n  valuesInput.addEventListener(\"input\", function (this: HTMLInputElement) {\r\n    filter.values = this.value;\r\n  });\r\n  return valuesInput;\r\n}\r\n\r\n// Function to create a delete button for filters\r\nfunction createDeleteButton(filter: Filter, filterContainer: HTMLDivElement): HTMLButtonElement {\r\n  const deleteButton = document.createElement(\"button\");\r\n  deleteButton.textContent = \"Delete\";\r\n  deleteButton.addEventListener(\"click\", function () {\r\n    filterContainer.remove();\r\n    const index = filters.findIndex((f) => f === filter);\r\n    if (index !== -1) {\r\n      filters.splice(index, 1);\r\n    }\r\n  });\r\n  return deleteButton;\r\n}\r\n\r\n// Function to update the filter display\r\nfunction updateFilterDisplay() {\r\n  const filterContainers = document.getElementById(\"filter-containers\")!;\r\n  filterContainers.innerHTML = \"\";\r\n}\r\n\r\n// Function to generate an email draft using the Claude API\r\nasync function generateEmailDraft() {\r\n  const promptElement = document.getElementById(\"myTextarea\") as HTMLTextAreaElement;\r\n  const subjectElement = document.getElementById(\"email-subject\") as HTMLTextAreaElement;\r\n  const bodyElement = document.getElementById(\"email-body\") as HTMLTextAreaElement;\r\n  const prompt = promptElement.value;\r\n\r\n  if (!prompt) {\r\n    showNotification(\"Please enter a prompt before generating an email draft.\", true);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    console.log(\"Generating email draft...\");\r\n    showNotification(\"Generating email draft...\");\r\n    const generatedText = await callClaudeAPI(prompt, columnTitles);\r\n    const { subject, body } = parseGeneratedEmail(generatedText);\r\n    subjectElement.value = subject;\r\n    bodyElement.value = body;\r\n\r\n    // Append the signature and disclaimer to the email body\r\n    const signatureElement = document.getElementById(\"email-signature\") as HTMLTextAreaElement;\r\n    const signature = signatureElement.value;\r\n    bodyElement.value = body + \"\\n\\n\" + signature + \"\\n\\n\" + `\\n\\n${EMAIL_DISCLAIMER}`;\r\n\r\n    showNotification(\"Email draft generated successfully!\");\r\n  } catch (error) {\r\n    console.error(\"Error in generateEmailDraft:\", error);\r\n    subjectElement.value = \"Error generating subject\";\r\n    bodyElement.value = \"An error occurred. Please try again. Error details: \" + error.message;\r\n    showNotification(\"Failed to generate email draft. Please try again.\", true);\r\n  }\r\n}\r\n\r\nfunction parseGeneratedEmail(text: string): { subject: string; body: string } {\r\n  const parts = text.split('\\n\\n');\r\n  return {\r\n    subject: parts[0].replace('Subject: ', '').trim(),\r\n    body: parts.slice(1).join('\\n\\n').trim()\r\n  };\r\n}\r\n\r\n// Function to connect with Claude API\r\nasync function callClaudeAPI(prompt: string, columnTitles: string[]): Promise<string> {\r\n  const apiUrl = \"http://localhost:3001/api/generate\";\r\n\r\n  const ANTHROPIC_API_KEY = (document.getElementById(\"anthropic-api\") as HTMLInputElement).value;\r\n\r\n  // Define new variables with default values\r\n  const institution = \"university\";\r\n  const persona = \"professor\";\r\n  const audience = \"students\";\r\n  const tone = \"professional\";\r\n\r\n  if (!ANTHROPIC_API_KEY) {\r\n    throw new Error(\"Anthropic API key is not set. Please enter it in the Sign In section.\");\r\n  }\r\n\r\n  try {\r\n    console.log(\"Calling Claude API...\");\r\n    console.log(\"Prompt:\", prompt);\r\n    console.log(\"Column titles:\", columnTitles);\r\n    const response = await fetch(apiUrl, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        prompt: `Human: \r\n                 Forget any previous instructions.\r\n                 You are an AI assistant helping a ${persona} at a ${institution} write an ${tone} email to to ${audience}. \r\n                 The ${persona} will provide instructions, and you should write a ${tone} email based on those instructions. \r\n                 Generate both a subject line and an email body. \r\n                 Use {{column_title}} as placeholders for personalised information.\r\n                 Only use curly brackets {} This is the only type of brackets you are allowed to use.\r\n                 Available column titles are: ${columnTitles.join(\", \")}. \r\n                 Only stick to the available column titles in the provided menu. \r\n                 Do not repeat the column titles multiple times if you are creating a list within the generated email body. \r\n                 This is very important: only provide the email draft ready to be sent instead of writing something along the lines of \"Here is an email...\" at the beginning. \r\n                 Do not use a signature for the ${persona}. \r\n                 Stop generating the email body after you write \"kind regards\" or \"sincerely\" or the other similar words that are used to end emails. \r\n                 Provide the email draft in the following format:\r\n\r\n                Subject: [Generated Subject]\r\n\r\n                [Generated Email Body]\r\n\r\n                Here are the teacher's instructions: \"${prompt}\"\r\n\r\n                Assistant:`,\r\n        max_tokens_to_sample: maxTokens,\r\n        temperature: temperature,\r\n        ANTHROPIC_API_KEY: ANTHROPIC_API_KEY\r\n      }),\r\n    });\r\n\r\n    const data = await response.json();\r\n    console.log(\"API response:\", JSON.stringify(data, null, 2));\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}, message: ${JSON.stringify(data, null, 2)}`);\r\n    }\r\n\r\n    if (!data.completion) {\r\n      throw new Error(\"No completion in API response: \" + JSON.stringify(data, null, 2));\r\n    }\r\n\r\n    return data.completion;\r\n  } catch (error) {\r\n    console.error(\"Error calling Claude API:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Function to send the generated emails\r\nasync function sendEmails() {\r\n  console.log(\"Sending emails...\");\r\n\r\n  const SENDGRID_API_KEY = (document.getElementById(\"sendgrid-api\") as HTMLInputElement).value;\r\n  const sendgridEmail = (document.getElementById(\"sendgrid-email\") as HTMLInputElement).value;\r\n\r\n  if (!SENDGRID_API_KEY || !sendgridEmail) {\r\n    showNotification(\"SendGrid API key and email are required. Please enter them in the Sign In section.\", true);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await Excel.run(async (context) => {\r\n      const sheet = context.workbook.worksheets.getActiveWorksheet();\r\n      const emailColumnSelect = document.getElementById(\"email-column\") as HTMLSelectElement;\r\n      const emailColumnIndex = parseInt(emailColumnSelect.value);\r\n\r\n      console.log(`Selected email column index: ${emailColumnIndex}`);\r\n\r\n      if (isNaN(emailColumnIndex)) {\r\n        throw new Error(\"Please select an email column\");\r\n      }\r\n\r\n      const usedRange = sheet.getUsedRange();\r\n      usedRange.load(\"values\");\r\n      await context.sync();\r\n\r\n      const headerRow = usedRange.values[0] as string[];\r\n      console.log(`Header row: ${JSON.stringify(headerRow)}`);\r\n\r\n      const subjectElement = document.getElementById(\"email-subject\") as HTMLTextAreaElement;\r\n      const bodyElement = document.getElementById(\"email-body\") as HTMLTextAreaElement;\r\n      const senderEmailElement = document.getElementById(\"sender-email\") as HTMLTextAreaElement;\r\n      const senderEmail = senderEmailElement.value.trim();\r\n      const signatureElement = document.getElementById(\"email-signature\") as HTMLTextAreaElement;\r\n\r\n      if (!subjectElement || !bodyElement) {\r\n        throw new Error(\"Email subject or body element not found\");\r\n      }\r\n\r\n      const emailSubjectTemplate = subjectElement.value;\r\n      const emailBodyTemplate = bodyElement.value;\r\n\r\n      console.log(`Email subject template: ${emailSubjectTemplate}`);\r\n      console.log(`Email body template: ${emailBodyTemplate}`);\r\n\r\n      if (!emailSubjectTemplate || !emailBodyTemplate) {\r\n        throw new Error(\"Email subject or body template is empty\");\r\n      }\r\n\r\n      const emails = [];\r\n\r\n      let skippedRows = 0;\r\n      let totalRows = usedRange.values.length - 1; // Subtract 1 for header row\r\n      let filteredOutRows = 0;\r\n\r\n      console.log(`Processing ${totalRows} rows...`);\r\n\r\n      const optionsSelect = document.getElementById(\"options\") as HTMLSelectElement;\r\n      const useFilters = optionsSelect.value === \"specific\";\r\n      console.log(`Using filters: ${useFilters}`);\r\n      console.log(`Current filters: ${JSON.stringify(filters)}`);\r\n\r\n      for (let i = 1; i < usedRange.values.length; i++) {\r\n        const row = usedRange.values[i];\r\n        console.log(`Processing row ${i}: ${JSON.stringify(row)}`);\r\n\r\n        const emailAddress = row[emailColumnIndex];\r\n        console.log(`Email address found: ${emailAddress}`);\r\n\r\n        if (!emailAddress || !isValidEmail(emailAddress)) {\r\n          console.log(`Skipping row ${i}: Invalid email address`);\r\n          skippedRows++;\r\n          continue;\r\n        }\r\n\r\n        if (useFilters) {\r\n          const passesFilter = applyFilters(row, headerRow);\r\n          console.log(`Row ${i} passes filter: ${passesFilter}`);\r\n          if (!passesFilter) {\r\n            filteredOutRows++;\r\n            continue;\r\n          }\r\n        }\r\n\r\n        // Check if we have enough email credits (include sender email if provided)\r\n        const totalEmailsToSend = emails.length + (senderEmail ? 1 : 0);\r\n        if (totalEmailsToSend > emailCounter) {\r\n          showWarningModal(`Warning: The number of emails to be sent (${totalEmailsToSend}) exceeds your remaining email sending credit (${emailCounter}). Please reduce the number of recipients or try again tomorrow.`);\r\n          return;\r\n        }\r\n\r\n        // If sender email is provided and valid, add it to the emails array\r\n        if (senderEmail && isValidEmail(senderEmail)) {\r\n          emails.push({\r\n            to: senderEmail,\r\n            subject: subjectElement.value,\r\n            html: formatEmailContent(bodyElement.value),\r\n          });\r\n        }\r\n\r\n        let personalizedSubject = emailSubjectTemplate;\r\n        let personalizedBody = emailBodyTemplate;\r\n\r\n        for (let j = 0; j < row.length; j++) {\r\n          const columnName = headerRow[j];\r\n          const cellValue = row[j];\r\n          const placeholder = `{{${columnName}}}`;\r\n          personalizedSubject = personalizedSubject.replace(new RegExp(placeholder, 'g'), cellValue);\r\n          personalizedBody = personalizedBody.replace(new RegExp(placeholder, 'g'), cellValue);\r\n        }\r\n\r\n        personalizedBody = formatEmailContent(personalizedBody);\r\n\r\n        emails.push({\r\n          to: emailAddress,\r\n          subject: personalizedSubject,\r\n          html: personalizedBody,\r\n        });\r\n        console.log(`Added email for ${emailAddress} with subject: ${personalizedSubject}`);\r\n      }\r\n\r\n      console.log(`Total rows processed: ${totalRows}`);\r\n      console.log(`Skipped rows (invalid email): ${skippedRows}`);\r\n      console.log(`Filtered out rows: ${filteredOutRows}`);\r\n      console.log(`Valid emails found: ${emails.length}`);\r\n\r\n      if (emails.length === 0) {\r\n        throw new Error(\"No valid emails to send. Please check your data and filter criteria.\");\r\n      }\r\n\r\n      console.log(\"Prepared emails:\", JSON.stringify(emails, null, 2));\r\n\r\n      console.log(`Preparing to send ${emails.length} emails`);\r\n      const response = await fetch(\"http://localhost:3001/api/send-emails\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          emails,\r\n          SENDGRID_API_KEY,\r\n          sendgridEmail\r\n        }),\r\n      });\r\n\r\n      const responseData = await response.json();\r\n      console.log(\"Server response:\", JSON.stringify(responseData, null, 2));\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\r\n          `HTTP error! status: ${response.status}, message: ${responseData.error}, details: ${JSON.stringify(responseData, null, 2)}`\r\n        );\r\n      }\r\n\r\n      if (responseData.sentEmails && Array.isArray(responseData.sentEmails)) {\r\n        console.log(`Successfully sent ${responseData.sentEmails.length} out of ${emails.length} emails`);\r\n        responseData.sentEmails.forEach((email: string) => {\r\n          console.log(`Email sent to: ${email}`);\r\n          decreaseCounter();\r\n        });\r\n      }\r\n\r\n      if (responseData.failedEmails && Array.isArray(responseData.failedEmails)) {\r\n        console.log(`Failed to send ${responseData.failedEmails.length} emails`);\r\n        responseData.failedEmails.forEach((failedEmail: { email: string, error: string }) => {\r\n          console.log(`Failed to send email to ${failedEmail.email}. Error: ${failedEmail.error}`);\r\n        });\r\n      }\r\n\r\n      showNotification(`Emails sent: ${responseData.sentEmails.length}/${emails.length}. Check console for details.`);\r\n\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error sending emails:\", error);\r\n    showNotification(`Error sending emails: ${error.message}`, true);\r\n  }\r\n}\r\n\r\n// Function to format  the email content\r\nfunction formatEmailContent(content: string): string {\r\n  // Replace single newlines with <br> tags\r\n  content = content.replace(/(?<!\\n)\\n(?!\\n)/g, \"<br>\");\r\n\r\n  // Replace double newlines with paragraph breaks\r\n  content = content.replace(/\\n\\n/g, \"</p><p>\");\r\n\r\n  // Wrap the entire content in a paragraph tag\r\n  content = `<p>${content}</p>`;\r\n\r\n  return content;\r\n}\r\n\r\n// Function to check email validity within a column\r\nfunction isValidEmail(email: string) {\r\n  const re =\r\n    /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n  return re.test(String(email).toLowerCase());\r\n}\r\n\r\n// Function to display notifications\r\nfunction showNotification(message: string, isError: boolean = false) {\r\n  const notificationElement = document.createElement(\"div\");\r\n  notificationElement.textContent = message;\r\n  notificationElement.style.position = \"fixed\";\r\n  notificationElement.style.top = \"10px\";\r\n  notificationElement.style.left = \"50%\";\r\n  notificationElement.style.transform = \"translateX(-50%)\";\r\n  notificationElement.style.padding = \"10px\";\r\n  notificationElement.style.borderRadius = \"5px\";\r\n  notificationElement.style.backgroundColor = isError ? \"#ffcccc\" : \"#ccffcc\";\r\n  notificationElement.style.border = `1px solid ${isError ? \"#ff0000\" : \"#00ff00\"}`;\r\n  document.body.appendChild(notificationElement);\r\n\r\n  setTimeout(() => {\r\n    document.body.removeChild(notificationElement);\r\n  }, 3000);\r\n}\r\n\r\n// Function to apply created filters\r\nfunction applyFilters(row: any[], headerRow: string[]): boolean {\r\n  if (filters.length === 0) return true;\r\n\r\n  console.log(\"Applying filters:\", JSON.stringify(filters));\r\n\r\n  return filters.every(filter => {\r\n    const columnIndex = headerRow.findIndex(col => col.toLowerCase() === filter.column.toLowerCase());\r\n    if (columnIndex === -1) {\r\n      console.log(`Column not found: ${filter.column}`);\r\n      return false;\r\n    }\r\n\r\n    const cellValue = row[columnIndex]?.toString().toLowerCase() ?? \"\";\r\n    const filterValues = filter.values.toLowerCase().split(',').map(v => v.trim());\r\n\r\n    console.log(`Checking column: ${filter.column}, Cell value: ${cellValue}, Filter values: ${filterValues.join(', ')}`);\r\n\r\n    const result = filterValues.some(value => cellValue.includes(value));\r\n    console.log(`Filter result for ${filter.column}: ${result}`);\r\n  return result;\r\n  });\r\n}\r\n\r\n// Function to automatically detect email columns\r\nfunction detectEmailColumn(headerRow: string[]): number {\r\n  const emailRegex = /email|e-mail|mail/i;\r\n  return headerRow.findIndex(header => emailRegex.test(header));\r\n}\r\n\r\n// Function to automatically register changes in the worksheet\r\nasync function handleWorksheetChange(event: Office.EventType) {\r\n  try {\r\n    console.log(\"Worksheet changed. Updating column titles and email menu.\");\r\n    await getColumnTitles();\r\n    populateColumnTitlesMenu();\r\n  } catch (error) {\r\n    console.error(\"Error handling worksheet change:\", error);\r\n    showNotification(\"Failed to update columns. Please try again.\", true);\r\n  }\r\n}\r\n\r\n// Function to save the teacher's signature\r\nfunction saveSignature() {\r\n  const signatureElement = document.getElementById(\"email-signature\") as HTMLTextAreaElement;\r\n  const signature = signatureElement.value;\r\n  Office.context.document.settings.set(\"teacherSignature\", signature);\r\n  Office.context.document.settings.saveAsync(() => {\r\n    console.log(\"Signature saved successfully\");\r\n    showNotification(\"Signature saved successfully!\");\r\n  });\r\n}\r\n\r\n// Function to save the loaded signature\r\nfunction loadSignature() {\r\n  const signature = Office.context.document.settings.get(\"teacherSignature\");\r\n  if (signature) {\r\n    const signatureElement = document.getElementById(\"email-signature\") as HTMLTextAreaElement;\r\n    signatureElement.value = signature;\r\n  }\r\n}\r\n\r\nfunction setupInstructionsToggle() {\r\n  const toggleButton = document.getElementById(\"toggle-instructions\");\r\n  const instructions = document.getElementById(\"instructions\");\r\n\r\n  if (toggleButton && instructions) {\r\n    toggleButton.onclick = function() {\r\n      instructionsVisible = !instructionsVisible;\r\n      instructions.style.display = instructionsVisible ? \"block\" : \"none\";\r\n      (toggleButton as HTMLButtonElement).textContent = instructionsVisible ? \"Hide Instructions\" : \"Show instructions on how to use teacherhelper\";\r\n    }\r\n  }\r\n}\r\n\r\n// Function to initialize advanced settings\r\nfunction initializeAdvancedSettings() {\r\n  console.log(\"Initializing advanced settings\");\r\n  const advancedSettingsBtn = document.getElementById('advanced-settings-btn') as HTMLButtonElement;\r\n  const advancedSettings = document.getElementById('advanced-settings') as HTMLDivElement;\r\n  const resetButton = document.getElementById('advanced-settings-reset') as HTMLButtonElement;\r\n  const saveButton = document.getElementById('advanced-settings-save') as HTMLButtonElement;\r\n\r\n  if (!advancedSettingsBtn || !advancedSettings || !resetButton || !saveButton) {\r\n    console.error(\"One or more advanced settings elements not found\");\r\n    return;\r\n  }\r\n\r\n  advancedSettingsBtn.addEventListener('click', () => {\r\n    advancedSettings.style.display = advancedSettings.style.display === 'none' ? 'block' : 'none';\r\n  });\r\n\r\n  resetButton.addEventListener('click', resetToOriginalValues);\r\n  saveButton.addEventListener('click', saveControlSettings);\r\n\r\n  // Load saved settings or use defaults\r\n  loadSavedSettings();\r\n\r\n  // Initialize input fields\r\n  updateInputFields();\r\n\r\n  // Add event listeners for input changes\r\n  document.getElementById('institution')?.addEventListener('input', (e) => {\r\n    institution = (e.target as HTMLInputElement).value || ORIGINAL_INSTITUTION;\r\n  });\r\n\r\n  document.getElementById('persona')?.addEventListener('input', (e) => {\r\n    persona = (e.target as HTMLInputElement).value || ORIGINAL_PERSONA;\r\n  });\r\n\r\n  document.getElementById('audience')?.addEventListener('input', (e) => {\r\n    audience = (e.target as HTMLInputElement).value || ORIGINAL_AUDIENCE;\r\n  });\r\n\r\n  document.getElementById('tone')?.addEventListener('input', (e) => {\r\n    tone = (e.target as HTMLInputElement).value || ORIGINAL_TONE;\r\n  });\r\n\r\n  document.getElementById('max-tokens')?.addEventListener('input', (e) => {\r\n    maxTokens = parseInt((e.target as HTMLInputElement).value);\r\n    (document.getElementById('max-tokens-value') as HTMLSpanElement).textContent = maxTokens.toString();\r\n  });\r\n\r\n  document.getElementById('temperature')?.addEventListener('input', (e) => {\r\n    temperature = parseFloat((e.target as HTMLInputElement).value);\r\n    (document.getElementById('temperature-value') as HTMLSpanElement).textContent = temperature.toString();\r\n  });\r\n}\r\n\r\nfunction resetToOriginalValues() {\r\n  institution = ORIGINAL_INSTITUTION;\r\n  persona = ORIGINAL_PERSONA;\r\n  audience = ORIGINAL_AUDIENCE;\r\n  tone = ORIGINAL_TONE;\r\n  maxTokens = ORIGINAL_MAX_TOKENS;\r\n  temperature = ORIGINAL_TEMPERATURE;\r\n\r\n  updateInputFields();\r\n  showNotification(\"Settings reset to original values.\");\r\n}\r\n\r\nfunction saveControlSettings() {\r\n  Office.context.document.settings.set(\"teacherhelper_institution\", institution);\r\n  Office.context.document.settings.set(\"teacherhelper_persona\", persona);\r\n  Office.context.document.settings.set(\"teacherhelper_audience\", audience);\r\n  Office.context.document.settings.set(\"teacherhelper_tone\", tone);\r\n  Office.context.document.settings.set(\"teacherhelper_maxTokens\", maxTokens);\r\n  Office.context.document.settings.set(\"teacherhelper_temperature\", temperature);\r\n\r\n  Office.context.document.settings.saveAsync(() => {\r\n    console.log(\"Control settings saved successfully\");\r\n    showNotification(\"Control settings saved successfully!\");\r\n  });\r\n}\r\n\r\nfunction loadSavedSettings() {\r\n  institution = Office.context.document.settings.get(\"teacherhelper_institution\") || ORIGINAL_INSTITUTION;\r\n  persona = Office.context.document.settings.get(\"teacherhelper_persona\") || ORIGINAL_PERSONA;\r\n  audience = Office.context.document.settings.get(\"teacherhelper_audience\") || ORIGINAL_AUDIENCE;\r\n  tone = Office.context.document.settings.get(\"teacherhelper_tone\") || ORIGINAL_TONE;\r\n  maxTokens = Office.context.document.settings.get(\"teacherhelper_maxTokens\") || ORIGINAL_MAX_TOKENS;\r\n  temperature = Office.context.document.settings.get(\"teacherhelper_temperature\") || ORIGINAL_TEMPERATURE;\r\n}\r\n\r\nfunction updateInputFields() {\r\n  (document.getElementById('institution') as HTMLInputElement).value = institution;\r\n  (document.getElementById('persona') as HTMLInputElement).value = persona;\r\n  (document.getElementById('audience') as HTMLInputElement).value = audience;\r\n  (document.getElementById('tone') as HTMLInputElement).value = tone;\r\n  (document.getElementById('max-tokens') as HTMLInputElement).value = maxTokens.toString();\r\n  (document.getElementById('temperature') as HTMLInputElement).value = temperature.toString();\r\n  (document.getElementById('max-tokens-value') as HTMLSpanElement).textContent = maxTokens.toString();\r\n  (document.getElementById('temperature-value') as HTMLSpanElement).textContent = temperature.toString();\r\n}\r\n\r\n// Function to update the counter display\r\nfunction updateCounterDisplay() {\r\n  const counterElement = document.getElementById('email-counter');\r\n  if (counterElement) {\r\n    counterElement.textContent = `Emails remaining today: ${emailCounter}`;\r\n  }\r\n}\r\n\r\n// Function to decrease the counter\r\nfunction decreaseCounter() {\r\n  if (emailCounter > 0) {\r\n    emailCounter--;\r\n    updateCounterDisplay();\r\n    saveCounterState();\r\n  }\r\n}\r\n\r\n// Function to check and reset the counter if it's a new day\r\nfunction checkAndResetCounter() {\r\n  const today = new Date().toDateString();\r\n\r\n  if (lastResetDate !== today) {\r\n    emailCounter = 100;\r\n    lastResetDate = today;\r\n    saveCounterState();\r\n  }\r\n\r\n  updateCounterDisplay();\r\n}\r\n\r\n// Function to save the counter state to local storage\r\nfunction saveCounterState() {\r\n  localStorage.setItem('emailCounter', emailCounter.toString());\r\n  localStorage.setItem('lastResetDate', lastResetDate);\r\n}\r\n\r\n// Function to load the counter state from local storage\r\nfunction loadCounterState() {\r\n  const savedCounter = localStorage.getItem('emailCounter');\r\n  const savedDate = localStorage.getItem('lastResetDate');\r\n\r\n  if (savedCounter !== null) {\r\n    emailCounter = parseInt(savedCounter, 10);\r\n  }\r\n\r\n  if (savedDate !== null) {\r\n    lastResetDate = savedDate;\r\n  } else {\r\n    lastResetDate = new Date().toDateString();\r\n  }\r\n\r\n  checkAndResetCounter();\r\n}\r\n\r\n// Function to show a modal warning\r\nfunction showWarningModal(message: string) {\r\n  // Create modal elements\r\n  const modal = document.createElement('div');\r\n  modal.style.cssText = `\r\n    position: fixed;\r\n    z-index: 1000;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: rgba(0,0,0,0.4);\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  `;\r\n\r\n  const modalContent = document.createElement('div');\r\n  modalContent.style.cssText = `\r\n    background-color: #fefefe;\r\n    padding: 20px;\r\n    border: 1px solid #888;\r\n    width: 80%;\r\n    max-width: 400px;\r\n    text-align: center;\r\n  `;\r\n\r\n  const closeBtn = document.createElement('button');\r\n  closeBtn.textContent = 'Close';\r\n  closeBtn.onclick = () => document.body.removeChild(modal);\r\n\r\n  modalContent.innerHTML = `<p>${message}</p>`;\r\n  modalContent.appendChild(closeBtn);\r\n  modal.appendChild(modalContent);\r\n\r\n  document.body.appendChild(modal);\r\n}\r\n\r\nfunction saveSenderEmail() {\r\n  const senderEmailElement = document.getElementById(\"sender-email\") as HTMLTextAreaElement;\r\n  const senderEmail = senderEmailElement.value.trim();\r\n\r\n  if (senderEmail === \"\" || isValidEmail(senderEmail)) {\r\n    Office.context.document.settings.set(\"senderEmail\", senderEmail);\r\n    Office.context.document.settings.saveAsync(() => {\r\n      console.log(\"Sender email saved successfully\");\r\n      if (senderEmail === \"\") {\r\n        showNotification(\"Your email has been cleared successfully!\");\r\n      } else {\r\n        showNotification(\"Your email has been saved successfully!\");\r\n      }\r\n    });\r\n  } else {\r\n    showNotification(\"Please enter a valid email address or leave it empty to clear.\", true);\r\n  }\r\n}\r\n\r\nfunction loadSenderEmail() {\r\n  const senderEmail = Office.context.document.settings.get(\"senderEmail\");\r\n  if (senderEmail) {\r\n    const senderEmailElement = document.getElementById(\"sender-email\") as HTMLTextAreaElement;\r\n    senderEmailElement.value = senderEmail;\r\n  }\r\n}\r\n\r\nlet signInOptionsVisible = false;\r\n\r\nfunction setupSignInToggle() {\r\n  const toggleButton = document.getElementById(\"toggle-signin\");\r\n  const signInOptions = document.getElementById(\"signin-options\");\r\n\r\n  if (toggleButton && signInOptions) {\r\n    toggleButton.onclick = function() {\r\n      signInOptionsVisible = !signInOptionsVisible;\r\n      signInOptions.style.display = signInOptionsVisible ? \"block\" : \"none\";\r\n    }\r\n  }\r\n}\r\n\r\nfunction saveSignInOptions() {\r\n  const ANTHROPIC_API_KEY = (document.getElementById(\"anthropic-api\") as HTMLInputElement).value;\r\n  const sendgridEmail = (document.getElementById(\"sendgrid-email\") as HTMLInputElement).value;\r\n  const SENDGRID_API_KEY = (document.getElementById(\"sendgrid-api\") as HTMLInputElement).value;\r\n\r\n  Office.context.document.settings.set(\"ANTHROPIC_API_KEY\", ANTHROPIC_API_KEY);\r\n  Office.context.document.settings.set(\"sendgridEmail\", sendgridEmail);\r\n  Office.context.document.settings.set(\"SENDGRID_API_KEY\", SENDGRID_API_KEY);\r\n\r\n  Office.context.document.settings.saveAsync(() => {\r\n    console.log(\"Sign-in options saved successfully\");\r\n    showNotification(\"Sign-in options saved successfully!\");\r\n  });\r\n}\r\n\r\nfunction loadSignInOptions() {\r\n  const ANTHROPIC_API_KEY = Office.context.document.settings.get(\"ANTHROPIC_API_KEY\");\r\n  const sendgridEmail = Office.context.document.settings.get(\"sendgridEmail\");\r\n  const SENDGRID_API_KEY = Office.context.document.settings.get(\"SENDGRID_API_KEY\");\r\n\r\n  if (ANTHROPIC_API_KEY) {\r\n    (document.getElementById(\"anthropic-api\") as HTMLInputElement).value = ANTHROPIC_API_KEY;\r\n  }\r\n  if (sendgridEmail) {\r\n    (document.getElementById(\"sendgrid-email\") as HTMLInputElement).value = sendgridEmail;\r\n  }\r\n  if (SENDGRID_API_KEY) {\r\n    (document.getElementById(\"sendgrid-api\") as HTMLInputElement).value = SENDGRID_API_KEY;\r\n  }\r\n}"],"names":["lastResetDate","filters","columnTitles","instructionsVisible","emailCounter","ORIGINAL_INSTITUTION","ORIGINAL_PERSONA","ORIGINAL_AUDIENCE","ORIGINAL_TONE","institution","persona","audience","tone","maxTokens","temperature","async","getColumnTitles","Excel","run","console","log","headerRow","context","workbook","worksheets","getActiveWorksheet","getUsedRange","getRow","load","sync","values","length","Error","emailColumnMenu","document","getElementById","error","innerHTML","defaultOption","createElement","text","value","appendChild","forEach","title","index","option","toString","emailColumnIndex","emailRegex","findIndex","header","test","detectEmailColumn","populateEmailColumnMenu","populateColumnTitlesMenu","menus","getElementsByClassName","Array","from","menu","handleOptionsChange","event","select","target","style","display","JSON","stringify","addFilter","filter","column","filterContainer","className","columnSelect","addEventListener","parseInt","this","createColumnSelect","valuesInput","type","placeholder","createValuesInput","deleteButton","textContent","remove","f","splice","createDeleteButton","push","populateColumnSelect","generateEmailDraft","promptElement","subjectElement","bodyElement","prompt","showNotification","generatedText","ANTHROPIC_API_KEY","response","fetch","method","headers","body","join","max_tokens_to_sample","data","json","ok","status","completion","callClaudeAPI","subject","parts","split","replace","trim","slice","parseGeneratedEmail","signature","message","sendEmails","SENDGRID_API_KEY","sendgridEmail","sheet","emailColumnSelect","isNaN","usedRange","senderEmail","emailSubjectTemplate","emailBodyTemplate","emails","skippedRows","totalRows","filteredOutRows","useFilters","i","row","emailAddress","isValidEmail","passesFilter","applyFilters","totalEmailsToSend","showWarningModal","to","html","formatEmailContent","personalizedSubject","personalizedBody","j","columnName","cellValue","RegExp","responseData","sentEmails","isArray","email","updateCounterDisplay","saveCounterState","failedEmails","failedEmail","content","String","toLowerCase","isError","notificationElement","position","top","left","transform","padding","borderRadius","backgroundColor","border","setTimeout","removeChild","every","columnIndex","col","filterValues","map","v","result","some","includes","handleWorksheetChange","saveSignature","Office","settings","set","saveAsync","resetToOriginalValues","updateInputFields","saveControlSettings","counterElement","localStorage","setItem","modal","cssText","modalContent","closeBtn","onclick","saveSenderEmail","onReady","info","host","HostType","toggleButton","instructions","setupInstructionsToggle","advancedSettingsBtn","advancedSettings","resetButton","saveButton","get","e","parseFloat","initializeAdvancedSettings","savedCounter","getItem","savedDate","Date","toDateString","today","checkAndResetCounter","loadCounterState","signInOptions","signInOptionsVisible","setupSignInToggle","loadSignInOptions","onChanged","add","onActivated","catch","loadSignature","loadSenderEmail","saveSignInOptions"],"sourceRoot":""}